# ğŸ›  Solidity æ™ºèƒ½åˆçº¦åº“

æœ¬ä»“åº“åŒ…å«ä¸€ç³»åˆ—å¤šåŠŸèƒ½ **Solidity åˆçº¦å’Œåº“**ï¼Œæ—¨åœ¨æå‡æ™ºèƒ½åˆçº¦çš„å¼€å‘ä½“éªŒã€‚æ¨¡å—æ¶µç›– **æ•°æ®ç»“æ„**ã€**ä»£ç†æ¨¡å¼**ã€**è®¿é—®æ§åˆ¶** ä»¥åŠ **å®‰å…¨å·¥å…·**ï¼ˆå¦‚é‡å…¥é”ï¼‰ã€‚

---

## ğŸ“š ç›®å½•

### **ğŸ“‚ æ•°æ®ç»“æ„**
1. [é€šç”¨é“¾è¡¨ç»“æ„](#1-é€šç”¨é“¾è¡¨ç»“æ„)
2. [BitMaps & MultiBitsMaps](#2-bitmaps--multibitsmaps)

### **ğŸ”„ ä»£ç†æ¨¡å¼**
3. [è‡ªå®ç°çš„å¯å‡çº§ä»£ç†ï¼ˆERC1967ï¼‰](#3-è‡ªå®ç°çš„å¯å‡çº§ä»£ç†erc1967)
4. [EIP-2535 é’»çŸ³æ ‡å‡†å®ç°](#4-eip-2535-é’»çŸ³æ ‡å‡†å®ç°)

### **ğŸ›  å·¥å…·åº“**
5. [åŸºäºæ—¶é—´çš„æƒé™ç®¡ç†](#5-åŸºäºæ—¶é—´çš„æƒé™ç®¡ç†)
6. [é‡å…¥é”åº“](#6-é‡å…¥é”åº“)

---

## 1. ğŸ—‚ é€šç”¨é“¾è¡¨ç»“æ„

ä¸€ä¸ªæ”¯æŒå¤šç§æ•°æ®ç±»å‹çš„çµæ´»é“¾è¡¨å®ç°ï¼Œä¼˜åŒ–äº†æ€§èƒ½å’Œ Gas è´¹ç”¨ã€‚

### ğŸ“„ **ä»£ç ä½ç½®**  
`contracts/structs/LinkedList.sol`

### âœ¨ **ç‰¹æ€§**

- **æ”¯æŒå¤šç§æ•°æ®ç±»å‹**ï¼šå­˜å‚¨ `bytes32`ã€`uint256` å’Œ `address` ç±»å‹ã€‚
- **å®Œæ•´çš„ CRUD æ“ä½œ**ï¼šæ”¯æŒæ·»åŠ ã€åˆ é™¤ã€æŸ¥è¯¢å’Œæ›´æ–°å…ƒç´ ã€‚
- **é˜Ÿåˆ—å®ç°**ï¼šæ”¯æŒ **LIFO**ï¼ˆåè¿›å…ˆå‡ºï¼‰å’Œ **FIFO**ï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰æ¨¡å¼ã€‚
- **Gas ä¼˜åŒ–**ï¼šæ‰€æœ‰æ“ä½œçš„æ—¶é—´å¤æ‚åº¦å‡ä¸º **O(1)**ã€‚

---

## 2. ğŸ—‚ BitMaps & MultiBitsMaps

### **æ¦‚è¿°**

æœ¬æ¨¡å—æä¾› Solidity å®ç°çš„é«˜æ•ˆä½å›¾ç»“æ„ï¼š

- **BitMaps**ï¼šæ¯ä¸ª bit ä»£è¡¨ä¸€ä¸ªå¸ƒå°”å€¼ï¼ˆ`0` æˆ– `1`ï¼‰ã€‚
- **MultiBitsMaps**ï¼šæ¯ä¸ªå…ƒç´ å ç”¨å¤šä¸ª bitï¼ˆå¦‚ 4-bit æˆ– 8-bitï¼‰ã€‚

è¿™äº›æ•°æ®ç»“æ„é€šè¿‡å°†å¤šä¸ªå€¼æ‰“åŒ…è¿› `uint256` å˜é‡ä¸­ï¼Œå¤§å¹…å‡å°‘å­˜å‚¨å¼€é”€ï¼Œæé«˜ Gas æ•ˆç‡ã€‚

### **BitMaps**

#### âœ¨ **ç‰¹æ€§**
- **å­˜å‚¨å¸ƒå°”å€¼**ï¼Œé€‚ç”¨äºæƒé™ç®¡ç†ã€ç‰¹æ€§å¼€å…³ç­‰åº”ç”¨ã€‚
- **åŸºäº `uint256` çš„æ˜ å°„**ï¼Œæ¯ä¸ª bit ä»£è¡¨ä¸€ä¸ªå…ƒç´ ã€‚
- **æä¾›è®¾ç½®ã€æ¸…é™¤å’ŒæŸ¥è¯¢æ“ä½œ**ã€‚

#### **ä¸»è¦å‡½æ•°**
```solidity
function set(BitMap storage bitmap, uint256 index) internal;
function unset(BitMap storage bitmap, uint256 index) internal;
function get(BitMap storage bitmap, uint256 index) internal view returns (bool);
```

### **MultiBitsMaps**

#### âœ¨ **ç‰¹æ€§**
- **å­˜å‚¨å°èŒƒå›´æ•´æ•°å€¼**ï¼Œå¦‚ 4-bitï¼ˆ0~15ï¼‰ã€8-bitï¼ˆ0~255ï¼‰ã€‚
- **å‡å°‘å­˜å‚¨å¼€é”€**ï¼Œé€‚ç”¨äºæ¸¸æˆå±æ€§ã€æŠ•ç¥¨æƒé‡ç­‰åº”ç”¨ã€‚

#### **ä¸»è¦å‡½æ•°**
```solidity
function set(Uint256FourBitsMap storage bitmap, uint256 index, uint8 value) internal;
function get(Uint256FourBitsMap storage bitmap, uint256 index) internal view returns (uint8);

function set(Uint256ByteMap storage bitmap, uint256 index, uint8 value) internal;
function get(Uint256ByteMap storage bitmap, uint256 index) internal view returns (uint8);
```

### **Gas ä¼˜åŒ–**
- **BitMaps** ä»…æ¶‰åŠ `SLOAD` æˆ– `SSTORE` æ“ä½œï¼Œæå¤§ä¼˜åŒ– Gas è´¹ç”¨ã€‚
- **MultiBitsMaps** é€šè¿‡æ•°æ®å‹ç¼©å‡å°‘å­˜å‚¨å†™å…¥ï¼Œæé«˜æ•ˆç‡ã€‚

---

## 3. ğŸ”„ è‡ªå®ç°çš„å¯å‡çº§ä»£ç†ï¼ˆERC1967ï¼‰

è¯¥æ¨¡å—å®ç°äº† **ç¬¦åˆ EIP-1967 çš„é€æ˜å¯å‡çº§ä»£ç†**ï¼Œå…è®¸é€»è¾‘åˆçº¦æ— ç¼å‡çº§ï¼ŒåŒæ—¶ä¿æŒå­˜å‚¨ä¸€è‡´æ€§å’Œè®¿é—®æ§åˆ¶ã€‚

### ğŸ“„ **ä»£ç ä½ç½®**
- `contracts/proxy/ERC1967/ERC1967Utils.sol`
- `contracts/proxy/ERC1967/ProxyAdmin.sol`
- `contracts/proxy/ERC1967/TransparentUpgradeableProxy.sol`

### âœ¨ **ç‰¹æ€§**
- **ç¬¦åˆ EIP-1967 è§„èŒƒ**ï¼Œç¡®ä¿å­˜å‚¨å¸ƒå±€ä¸€è‡´æ€§ã€‚
- **é€æ˜ä»£ç†æ¨¡å¼**ï¼Œå°†ç®¡ç†æƒé™ä¸æ™®é€šç”¨æˆ·æ“ä½œåˆ†å¼€ã€‚
- **æ”¯æŒå‡çº§é€»è¾‘åˆçº¦**ï¼Œå¹¶å¯åœ¨å‡çº§æ—¶è¿›è¡Œåˆå§‹åŒ–ã€‚
- **å®‰å…¨çš„ç®¡ç†å‘˜æ§åˆ¶**ï¼Œæä¾›æƒé™ç®¡ç†å’Œè½¬ç§»åŠŸèƒ½ã€‚

---

## 4. ğŸ”„ EIP-2535 é’»çŸ³æ ‡å‡†å®ç°

è¯¥æ¨¡å—æä¾›äº† [EIP-2535 é’»çŸ³æ ‡å‡†](https://eips.ethereum.org/EIPS/eip-2535) çš„è‡ªå®šä¹‰å®ç°ï¼Œæ”¯æŒæ¨¡å—åŒ–ã€åŠ¨æ€æ‹“å±•çš„æ™ºèƒ½åˆçº¦æ¶æ„ã€‚

### ğŸ“„ **ä»£ç ä½ç½®**  
`contracts/proxy/EIP2535/*.sol`

### âœ¨ **ç‰¹æ€§**
- **åŠ¨æ€æ·»åŠ ã€æ›¿æ¢å’Œåˆ é™¤åˆçº¦å‡½æ•°**ã€‚
- **æ¨¡å—åŒ–å­˜å‚¨ç®¡ç†**ï¼Œæ”¯æŒ Facet ç»“æ„ã€‚
- **æ›´çµæ´»çš„åˆçº¦ç®¡ç†**ï¼Œé€‚ç”¨äºå¤æ‚ DAppã€‚

---

## 5. â³ åŸºäºæ—¶é—´çš„æƒé™ç®¡ç†

è¯¥æ¨¡å—å®ç°äº† **åŸºäºæ—¶é—´çš„è®¿é—®æ§åˆ¶** æœºåˆ¶ï¼Œå…è®¸ç®¡ç†å‘˜æˆäºˆç”¨æˆ·ç‰¹å®šåŠŸèƒ½çš„ **é™æ—¶è®¿é—®æƒé™**ï¼Œé€‚ç”¨äºè®¢é˜…æœåŠ¡æˆ–æ—¶æ•ˆæ€§æƒé™ç®¡ç†ã€‚

### ğŸ“„ **ä»£ç ä½ç½®**  
`contracts/utils/GrantPrivileges.sol`

### âœ¨ **ç‰¹æ€§**
- **ç®¡ç†å‘˜æ§åˆ¶**ï¼šåªæœ‰ç®¡ç†å‘˜å¯ç®¡ç†æˆæƒç”¨æˆ·ã€‚
- **åŸºäºæ—¶é—´çš„è®¿é—®æƒé™**ï¼Œç”¨æˆ·åœ¨è®¾å®šæ—¶é—´å†…æ‹¥æœ‰æƒé™ã€‚
- **å¯æ‰©å±•çš„è§’è‰²æ§åˆ¶**ï¼š
  - `onlyAdmin`ï¼šä»…é™ç®¡ç†å‘˜è°ƒç”¨ã€‚
  - `onlyOwner`ï¼šé™æ—¶è®¿é—®æƒé™ç”¨æˆ·å¯è°ƒç”¨ã€‚
- **åŠ¨æ€æƒé™ç®¡ç†**ï¼š
  - `addOwner(address, uint)`ï¼šæˆæƒç”¨æˆ·è®¿é—®æƒé™ã€‚
  - `getRemainingTime()`ï¼šæŸ¥è¯¢å‰©ä½™è®¿é—®æ—¶é—´ã€‚
  - `changeAdmin(address)`ï¼šç®¡ç†å‘˜æƒé™è½¬ç§»ã€‚

---

## 6. ğŸ”’ é‡å…¥é”åº“

æä¾›é«˜æ•ˆçš„ **é‡å…¥ä¿æŠ¤æœºåˆ¶**ï¼ŒåŒ…æ‹¬ **åŸºäºç¬æ€å­˜å‚¨ï¼ˆEIP-1153ï¼‰** å’Œ **ä¼ ç»Ÿå­˜å‚¨** ç‰ˆæœ¬ã€‚

### ğŸ“„ **ä»£ç ä½ç½®**
- **ç¬æ€å­˜å‚¨ç‰ˆï¼ˆEIP-1153ï¼‰**
  - `contracts/utils/AbstractNonReentrantLockTransient.sol`
  - `contracts/utils/NonReentrantLockTransient.sol`
- **æ ‡å‡†å­˜å‚¨ç‰ˆ**
  - `contracts/utils/AbstractNonReentrantLock.sol`
  - `contracts/utils/NonReentrantLock.sol`

### âœ¨ **ç‰¹æ€§**
- **é»˜è®¤ & è‡ªå®šä¹‰é”**ï¼šæ”¯æŒå…¨å±€é”æˆ–è‡ªå®šä¹‰é”ï¼ˆ`string` ä½œä¸ºå”¯ä¸€æ ‡è¯†ï¼‰ã€‚
- **Gas ä¼˜åŒ–**ï¼š
  - **ç¬æ€å­˜å‚¨** è‡ªåŠ¨åœ¨äº¤æ˜“ç»“æŸæ—¶é‡ç½®ï¼Œå‡å°‘ Gas æ¶ˆè€—ã€‚
  - **æ ‡å‡†å­˜å‚¨** é€‚ç”¨äºä¸æ”¯æŒ EIP-1153 çš„é“¾ã€‚
- **ç®€åŒ–çš„ä¿®é¥°ç¬¦**ï¼š`nonReentrantLock` å’Œ `nonReentrantcustomizeLock`ã€‚

---

âœ¨ **æ¬¢è¿è´¡çŒ®ï¼**

æœ¬é¡¹ç›®æŒç»­ä¼˜åŒ–ä¸­ï¼Œæ¬¢è¿ PR å’Œ Issueï¼ğŸ’¡

